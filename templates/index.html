<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FX Comparison Tool</title>
</head>
<body>
    <h2>FX Comparison Tool</h2>

    <form id="fx-form">
        <label for="from">From Currency:</label>
        <input id="from" name="from" value="USD" required><br><br>

        <label for="to">To Currency:</label>
        <input id="to" name="to" value="EUR" required><br><br>

        <label for="date">Date:</label>
        <input id="date" name="date" type="date" required><br><br>

        <label for="time">Time:</label>
        <input id="time" name="time" type="time"><br><br>

        <label for="amount">Amount:</label>
        <input id="amount" name="amount" type="number" step="0.01" required><br><br>

        <label for="bankRate">Bank Rate:</label>
        <input id="bankRate" name="bankRate" type="number" step="0.0001" required><br><br>

        <label for="annualVolume">Annual Volume:</label>
        <input id="annualVolume" name="annualVolume" type="number"><br><br>

        <button type="submit">Compare</button>
    </form>

    <div id="results" style="margin-top: 30px;"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (!token) {
            document.body.innerHTML = "<h2 style='color:red;'>❌ Missing token in URL.</h2>";
        }

        document.getElementById("fx-form").addEventListener("submit", async function(e) {
            e.preventDefault();

            const from = document.getElementById("from").value;
            const to = document.getElementById("to").value;
            const date = document.getElementById("date").value;
            const time = document.getElementById("time").value;
            const amount = document.getElementById("amount").value;
            const bankRate = document.getElementById("bankRate").value;
            const annualVolume = document.getElementById("annualVolume").value;

            try {
                const res = await fetch("/compare", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        token,
                        from,
                        to,
                        amount,
                        bankRate,
                        date,
                        time,
                        annualVolume
                    })
                });

                const data = await res.json();

                if (data.error) {
                    document.getElementById("results").innerHTML =
                        `<p style="color:red;"><strong>❌ ${data.error}</strong></p>`;
                } else {
                    document.getElementById("results").innerHTML = `
                        <p><strong>✅ Ocean Capital Exchange Rate:</strong> ${data.company_rate}</p>
                        <p><strong>Your Bank Gave You:</strong> ${data.bank_value}</p>
                        <p><strong>We Would Have Given You:</strong> ${data.company_value}</p>
                        <p><strong>Potential Savings:</strong> ${data.difference}</p>
                        <p><strong>Margin:</strong> ${data.spread_percent}%</p>
                        <p><strong>Projected Annual Savings:</strong> ${data.annual_savings}</p>
                        <p><strong>Approximate Time of Transaction:</strong> ${time}</p>
                    `;
                }
            } catch (err) {
                console.error("Fetch error:", err);
                document.getElementById("results").innerHTML =
                    "<p style='color:red;'>❌ Something went wrong. Please try again later.</p>";
            }
        });
    </script>
</body>
</html>
